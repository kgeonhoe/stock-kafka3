# Streamlit Dashboard 사용 가이드

## 📋 목차
1. [대시보드 개요](#대시보드-개요)
2. [페이지별 상세 가이드](#페이지별-상세-가이드)
3. [사용 시나리오](#사용-시나리오)
4. [트러블슈팅](#트러블슈팅)

---

## 🚀 대시보드 개요

Stock Pipeline의 Streamlit 대시보드는 실시간 주식 데이터 모니터링, 기술적 분석, API 성능 테스트 등을 위한 통합 웹 인터페이스입니다.

### 접속 방법
```bash
# Docker Compose로 실행 (권장)
cd /home/grey1/stock-kafka3/docker
docker-compose up -d streamlit

# 브라우저에서 접속
http://localhost:8501
```

### 전체 페이지 구조
```
📊 Main Dashboard (monitoring_dashboard.py)
├── 01_API_테스트_대시보드.py
├── 02_주식_데이터_조회.py
├── 03_기술적_지표_분석.py
├── 04_관심종목_관리.py
├── 05_실시간_Redis_모니터링.py
├── 06_Kafka_모니터링.py
├── 07_Postgres_모니터링.py
├── 08_시스템_리소스_모니터링.py
├── 09_백테스팅_분석.py
└── 10_알림_설정.py
```

---

## 📄 페이지별 상세 가이드

### 1️⃣ API 테스트 대시보드 (`01_API_테스트_대시보드.py`)

#### 📌 목적
한국투자증권 OpenAPI 및 Yahoo Finance API의 연결 상태와 성능을 테스트하고 모니터링합니다.

#### 🎯 주요 기능

##### API 테스트 실행
- **한국투자증권 API 테스트**
  - 인증 토큰 발급 테스트
  - 실시간 시세 조회 테스트
  - 일봉/분봉 데이터 조회 테스트
  - 응답 시간 측정

- **Yahoo Finance API 테스트**
  - 종목 정보 조회
  - 과거 가격 데이터 조회
  - 실시간 데이터 스트리밍 테스트

##### 실시간 모니터링
```
📊 표시 지표:
- API 응답 시간 (ms)
- 성공/실패율 (%)
- 분당 요청 수 (RPM)
- 에러 발생 빈도
- 네트워크 레이턴시
```

##### 성능 분석
- **응답 시간 분포**: 히스토그램으로 API 응답 시간 분포 표시
- **시간대별 성능**: 24시간 동안의 API 성능 추이
- **에러율 분석**: 에러 타입별 발생 빈도와 원인 분석

##### 설정 히스토리
- API 키 변경 이력
- Rate Limit 설정 변경
- 타임아웃 설정 이력
- 재시도 정책 변경 기록

#### 💡 사용 방법
```python
# 1. API 테스트 실행
1. 좌측 사이드바에서 테스트할 API 선택
2. 테스트 항목 체크 (전체 선택 가능)
3. "테스트 실행" 버튼 클릭
4. 결과 확인 (성공: 🟢, 실패: 🔴)

# 2. 벤치마크 테스트
1. "부하 테스트" 탭 선택
2. 동시 요청 수 설정 (1-100)
3. 테스트 기간 설정 (1-60분)
4. "벤치마크 시작" 클릭
5. 실시간 그래프로 성능 모니터링
```

---

### 2️⃣ 주식 데이터 조회 (`02_주식_데이터_조회.py`)

#### 📌 목적
PostgreSQL에 저장된 주식 데이터를 조회하고 시각화합니다.

#### 🎯 주요 기능

##### 데이터 조회
- **종목별 조회**: 특정 종목의 과거 데이터 조회
- **기간별 조회**: 날짜 범위로 데이터 필터링
- **다중 종목 비교**: 여러 종목 동시 비교

##### 차트 시각화
```
📈 차트 유형:
- 캔들스틱 차트 (OHLC)
- 거래량 차트
- 이동평균선 (5, 20, 60, 120일)
- 볼린저 밴드
- 수익률 차트
```

#### 💡 사용 방법
```sql
-- 데이터 조회 예시
1. 종목 심볼 입력 (예: AAPL, GOOGL)
2. 날짜 범위 선택
3. 표시할 지표 선택
4. "조회" 버튼 클릭
5. 차트 인터랙션:
   - 드래그: 확대/축소
   - 더블클릭: 초기화
   - 호버: 상세 정보
```

---

### 3️⃣ 기술적 지표 분석 (`03_기술적_지표_분석.py`)

#### 📌 목적
실시간으로 계산된 기술적 지표를 분석하고 매매 신호를 감지합니다.

#### 🎯 주요 기능

##### 지표 계산
```python
계산되는 지표:
- RSI (Relative Strength Index)
- MACD (Moving Average Convergence Divergence)
- 볼린저 밴드 (Bollinger Bands)
- 스토캐스틱 (Stochastic)
- ADX (Average Directional Index)
- OBV (On-Balance Volume)
```

##### 신호 감지
- **매수 신호**
  - RSI < 30 (과매도)
  - MACD 골든크로스
  - 볼린저 밴드 하단 터치

- **매도 신호**
  - RSI > 70 (과매수)
  - MACD 데드크로스
  - 볼린저 밴드 상단 터치

#### 💡 지표별 의미

| 지표 | 정상 범위 | 매수 신호 | 매도 신호 | 의미 |
|------|----------|----------|----------|------|
| RSI | 30-70 | < 30 | > 70 | 과매도/과매수 판단 |
| MACD | - | 상향 교차 | 하향 교차 | 추세 전환 시점 |
| 볼린저 밴드 | 중간선 ±2σ | 하단 터치 | 상단 터치 | 변동성과 지지/저항 |
| 스토캐스틱 | 20-80 | < 20 | > 80 | 단기 모멘텀 |

---

### 4️⃣ 관심종목 관리 (`04_관심종목_관리.py`)

#### 📌 목적
관심종목(Watchlist)을 관리하고 알림 조건을 설정합니다.

#### 🎯 주요 기능

##### 종목 관리
- **추가**: 새로운 관심종목 등록
- **삭제**: 기존 종목 제거
- **우선순위**: 중요도에 따른 정렬
- **그룹화**: 섹터별, 전략별 그룹 관리

##### 알림 조건 설정
```yaml
가격 조건:
  - 목표가 도달: 특정 가격 이상/이하
  - 변동률: 일일 변동률 ±N%
  - 52주 신고가/신저가

거래량 조건:
  - 거래량 급증: 평균 대비 N배
  - 거래대금: 특정 금액 이상

기술적 조건:
  - RSI 과매도/과매수
  - MACD 크로스
  - 볼린저 밴드 이탈
```

#### 💡 사용 시나리오
```
시나리오 1: 단기 스윙 트레이딩
1. RSI < 30 종목 자동 추가
2. 목표 수익률 5% 설정
3. 손절선 -3% 설정
4. 알림 활성화

시나리오 2: 장기 투자
1. 우량주 리스트 추가
2. 52주 신저가 알림 설정
3. 분할 매수 구간 설정
```

---

### 5️⃣ 실시간 Redis 모니터링 ([`stock-kafka3/streamlit/pages/05_실시간_Redis_모니터링.py`](stock-kafka3/streamlit/pages/05_실시간_Redis_모니터링.py ))

#### 📌 목적
Redis에 캐싱된 실시간 데이터와 기술적 신호를 모니터링합니다.

#### 🎯 주요 기능

##### 신호 추적 탭
```python
활성 신호 모니터링:
- 신호 타입: 볼린저, RSI, MACD 등
- Trigger Price: 신호 발생 시점 가격
- 현재 가격: 실시간 업데이트
- 수익률: (현재가 - Trigger Price) / Trigger Price
- 신호 강도: 조건 충족 정도
```

##### 실시간 데이터 탭
- **가격 데이터**: 실시간 주가, 변동률, 거래량
- **기술적 지표**: RSI, MACD, 볼린저 밴드 값
- **업데이트 주기**: 1초 단위 자동 새로고침

##### Redis 상태 탭
```
모니터링 지표:
- 메모리 사용량: used_memory_human
- 연결 클라이언트: connected_clients
- 초당 명령어: instantaneous_ops_per_sec
- 캐시 히트율: keyspace_hits / (hits + misses)
- TTL 상태: 만료 예정 키 수
```

#### 💡 Trigger Price 이해하기

**관심종목 Trigger Price** (PostgreSQL 기반)
- 정의: 관심종목으로 등록한 날의 종가
- 용도: 장기 수익률 계산 기준
- 특징: 고정값 (변경되지 않음)

**활성 신호 Trigger Price** (Redis 기반)
- 정의: 기술적 조건이 실시간으로 충족된 시점의 가격
- 용도: 단기 매매 타이밍 판단
- 특징: 동적값 (신호마다 다름)

---

### 6️⃣ Kafka 모니터링 (`06_Kafka_모니터링.py`)

#### 📌 목적
Kafka 메시지 큐의 상태와 처리량을 모니터링합니다.

#### 🎯 주요 지표

##### 토픽별 메트릭
```
- 메시지 생산량 (msgs/sec)
- 메시지 소비량 (msgs/sec)
- 지연(Lag): 미처리 메시지 수
- 파티션 상태
- 컨슈머 그룹 상태
```

##### 브로커 상태
- CPU/메모리 사용률
- 네트워크 I/O
- 디스크 사용량
- JVM 힙 메모리

---

### 7️⃣ PostgreSQL 모니터링 (`07_Postgres_모니터링.py`)

#### 📌 목적
PostgreSQL 데이터베이스의 성능과 상태를 모니터링합니다.

#### 🎯 주요 지표

##### 쿼리 성능
```sql
모니터링 항목:
- 슬로우 쿼리 (>1초)
- 쿼리 실행 계획
- 인덱스 사용률
- 테이블 스캔 빈도
```

##### 데이터베이스 상태
- 활성 연결 수
- 트랜잭션 처리량
- 테이블 크기
- 인덱스 크기
- VACUUM 상태

---

### 8️⃣ 시스템 리소스 모니터링 (`08_시스템_리소스_모니터링.py`)

#### 📌 목적
서버 리소스 사용량을 실시간으로 모니터링합니다.

#### 🎯 모니터링 대상
```
CPU: 사용률, 코어별 부하
메모리: 사용량, 스왑, 캐시
디스크: I/O, 사용량, IOPS
네트워크: 대역폭, 패킷 손실
Docker: 컨테이너별 리소스
```

---

## 🔧 트러블슈팅

### 문제 1: Redis 연결 실패
```bash
# 해결 방법
docker-compose restart redis
docker logs redis-stock
```

### 문제 2: PostgreSQL 쿼리 느림
```sql
-- 인덱스 확인
SELECT * FROM pg_indexes WHERE tablename = 'stock_data';
-- VACUUM 실행
VACUUM ANALYZE stock_data;
```

### 문제 3: Streamlit 페이지 로딩 실패
```python
# 패키지 재설치
pip install -r requirements-streamlit.txt
# 캐시 삭제
streamlit cache clear
```

---

## 📚 추가 자료

- Redis 데이터 관리 가이드
- Kafka 토픽 컨슈머 가이드
- Airflow DAG 구현 상세

---

*최종 업데이트: 2025-08-09*
