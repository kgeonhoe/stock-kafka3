#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
í•œêµ­íˆ¬ìì¦ê¶Œ KIS API - í•´ì™¸ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘ ê°€ëŠ¥ì„± ë¶„ì„
"""

class KISOverseaStockAnalysis:
    """KIS API í•´ì™¸ ì£¼ì‹ ë¶„ì„ í´ë˜ìŠ¤"""
    
    def __init__(self):
        """KIS í•´ì™¸ ì£¼ì‹ API ë¶„ì„ ì´ˆê¸°í™”"""
        self.base_url = "https://openapi.koreainvestment.com:9443"
    
    def analyze_overseas_apis(self):
        """í•´ì™¸ ì£¼ì‹ ê´€ë ¨ API ë¶„ì„"""
        
        print("ğŸŒ KIS API í•´ì™¸ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘ ê°€ëŠ¥ì„± ë¶„ì„")
        print("=" * 60)
        
        print("1ï¸âƒ£ í•´ì™¸ ì£¼ì‹ ì¼ë³„ ì‹œì„¸ ì¡°íšŒ:")
        print("  ğŸ“¡ API: /uapi/overseas-price/v1/quotations/dailyprice")
        print("  ğŸ” TR_ID: HHDFS76240000 (ë¯¸êµ­), HHDFS76950000 (í™ì½©) ë“±")
        print("  ğŸ“… ê¸°ëŠ¥: í•´ì™¸ ì£¼ì‹ ì¼ë³„ OHLCV ë°ì´í„°")
        print("  ğŸ¯ ëŒ€ìƒ: ë¯¸êµ­(NASDAQ, NYSE), í™ì½©, ì¼ë³¸, ìœ ëŸ½ ë“±")
        
        print("\n  ğŸ“‹ ìš”ì²­ íŒŒë¼ë¯¸í„°:")
        print("    â€¢ AUTH: ì¸ì¦ í† í°")
        print("    â€¢ APPKEY: ì•±í‚¤")
        print("    â€¢ APPSECRET: ì•±ì‹œí¬ë¦¿")
        print("    â€¢ TR_ID: ê±°ë˜ì†Œë³„ TR_ID")
        print("    â€¢ SYMB: ì¢…ëª© ì‹¬ë³¼ (ì˜ˆ: AAPL)")
        print("    â€¢ GUBN: ì¼ë³„(0), ì£¼ë³„(1), ì›”ë³„(2)")
        print("    â€¢ BYMD: ê¸°ì¤€ì¼ì (YYYYMMDD)")
        print("    â€¢ MODP: ìˆ˜ì •ì£¼ê°€ ë°˜ì˜ ì—¬ë¶€")
        
        print("\n  ğŸ“Š ì‘ë‹µ ë°ì´í„°:")
        print("    â€¢ rsym: ì‹¤ì‹œê°„ ì‹¬ë³¼")
        print("    â€¢ zdiv: ì†Œìˆ˜ì  ìë¦¬ìˆ˜")
        print("    â€¢ base: ê¸°ì¤€ê°€")
        print("    â€¢ pvol: ê±°ë˜ëŸ‰")
        print("    â€¢ output2 ë°°ì—´:")
        print("      - xymd: ì¼ì")
        print("      - open: ì‹œê°€")
        print("      - high: ê³ ê°€")
        print("      - low: ì €ê°€")
        print("      - clos: ì¢…ê°€")
        print("      - tvol: ê±°ë˜ëŸ‰")
        
        print("\n2ï¸âƒ£ í•´ì™¸ ì£¼ì‹ ë¶„ë³„ ì‹œì„¸ ì¡°íšŒ:")
        print("  ğŸ“¡ API: /uapi/overseas-price/v1/quotations/inquire-time-itemchartprice")
        print("  ğŸ” TR_ID: HHDFS76410000")
        print("  ğŸ“… ê¸°ëŠ¥: ë¶„ë³„ ì°¨íŠ¸ ë°ì´í„°")
        print("  â° ë‹¨ìœ„: 1ë¶„, 3ë¶„, 5ë¶„, 10ë¶„, 15ë¶„, 30ë¶„, 60ë¶„")
        
        print("\n3ï¸âƒ£ ì œì•½ì‚¬í•­ ë° í•œê³„:")
        print("  ğŸš« ê³¼ê±° ë°ì´í„° ì œí•œ:")
        print("    â€¢ ì¼ë³„: ìµœëŒ€ 100ì¼ (ì•½ 3-4ê°œì›”)")
        print("    â€¢ ë¶„ë³„: ìµœëŒ€ 120ê±´ (1ì¼~1ì£¼ì¼)")
        print("    â€¢ ì¥ê¸° íˆìŠ¤í† ë¦¬: ì œí•œì ")
        print("  ")
        print("  ğŸ”„ í˜¸ì¶œ ì œí•œ:")
        print("    â€¢ ì´ˆë‹¹ 20ê±´ ì œí•œ")
        print("    â€¢ ë¶„ë‹¹ 1000ê±´ ì œí•œ")
        print("    â€¢ ì¼ì¼ ì œí•œ ìˆìŒ (ì •í™•í•œ ìˆ˜ì¹˜ ë¯¸ê³µê°œ)")
        
        print("\n4ï¸âƒ£ yfinance vs KIS í•´ì™¸ ì£¼ì‹ ë¹„êµ:")
        
        print("\n  ğŸ“Š yfinance ì¥ì :")
        print("    âœ… ë¬´ë£Œ, ë¬´ì œí•œ")
        print("    âœ… 5ë…„+ ì¥ê¸° ë°ì´í„°")
        print("    âœ… ì‹ ì²­/ìŠ¹ì¸ ë¶ˆí•„ìš”")
        print("    âœ… ê°„ë‹¨í•œ API (period='5y')")
        print("    âœ… ì „ì„¸ê³„ ê±°ë˜ì†Œ ì§€ì›")
        
        print("  ğŸ“Š yfinance ë‹¨ì :")
        print("    âŒ ë¹„ê³µì‹ API (ë³€ê²½ ìœ„í—˜)")
        print("    âŒ ì‹¤ì‹œê°„ ë°ì´í„° ì œí•œ")
        print("    âŒ ì¼ë¶€ ì¢…ëª© ëˆ„ë½ ê°€ëŠ¥")
        print("    âš ï¸ í˜¸ì¶œ ì œí•œ (rate limiting)")
        
        print("\n  ğŸ“Š KIS í•´ì™¸ ì£¼ì‹ ì¥ì :")
        print("    âœ… ê³µì‹ API (ì•ˆì •ì„±)")
        print("    âœ… ì‹¤ì‹œê°„ ë°ì´í„°")
        print("    âœ… ì •í™•í•œ ë°ì´í„°")
        print("    âœ… ë¶„ë³„ ë°ì´í„° ì§€ì›")
        
        print("  ğŸ“Š KIS í•´ì™¸ ì£¼ì‹ ë‹¨ì :")
        print("    âŒ ê³„ì¢Œ ê°œì„¤ í•„ìˆ˜")
        print("    âŒ API ì‹ ì²­/ìŠ¹ì¸ í•„ìš”")
        print("    âŒ ê³¼ê±° ë°ì´í„° ì œí•œ (ìµœëŒ€ 100ì¼)")
        print("    âŒ í˜¸ì¶œ ì œí•œ (ì´ˆë‹¹ 20ê±´)")
        print("    âŒ 5ë…„ íˆìŠ¤í† ë¦¬ ë¶ˆê°€ëŠ¥")
        
        return True
    
    def recommend_strategy(self):
        """ìµœì  ì „ëµ ì¶”ì²œ"""
        
        print("\nğŸ¯ í•´ì™¸ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘ ìµœì  ì „ëµ:")
        print("=" * 60)
        
        print("1ï¸âƒ£ í˜„ì¬ ìƒí™© (ìµœê·¼ 1ë…„ë§Œ ìˆëŠ” ê²½ìš°):")
        print("  ğŸ”§ ë°±í•„(Backfill) ì „ëµ:")
        print("    â€¢ yfinanceë¡œ ê³¼ê±° 4ë…„ ë°ì´í„° ë°±í•„")
        print("    â€¢ ì—°ë„ë³„ ë¶„í•  ìˆ˜ì§‘ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´")
        print("    â€¢ ì˜ˆ: 2020ë…„ â†’ 2021ë…„ â†’ 2022ë…„ â†’ 2023ë…„")
        
        print("\n2ï¸âƒ£ í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜:")
        print("  ğŸ“Š ì—­í•  ë¶„ë‹´:")
        print("    â€¢ yfinance: ê³¼ê±° ë°ì´í„° + ì¼ì¼ ì¦ë¶„ ì—…ë°ì´íŠ¸")
        print("    â€¢ KIS API: ì‹¤ì‹œê°„ ë°ì´í„° + ë¶„ë³„ ë°ì´í„°")
        print("    â€¢ ë³´ì™„ì  ì‚¬ìš©ìœ¼ë¡œ ê°ê°ì˜ ì¥ì  í™œìš©")
        
        print("\n3ï¸âƒ£ ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš:")
        print("  Phase 1 (ì¦‰ì‹œ): yfinance ì¦ë¶„ ì—…ë°ì´íŠ¸ ìµœì í™”")
        print("    âœ… í˜„ì¬ ì§„í–‰ ì¤‘")
        print("    â€¢ 18ì‹œê°„ â†’ 5ë¶„ìœ¼ë¡œ ë‹¨ì¶•")
        print("    â€¢ API í˜¸ì¶œ ìµœì†Œí™”")
        print("    â€¢ ì•ˆì •ì„± í™•ë³´")
        
        print("\n  Phase 2 (1ì£¼ì¼ ë‚´): ê³¼ê±° ë°ì´í„° ë°±í•„")
        print("    ğŸ¯ ëª©í‘œ: 5ë…„ ì „ì²´ ë°ì´í„° í™•ë³´")
        print("    â€¢ ì—°ë„ë³„ ë¶„í•  ìˆ˜ì§‘")
        print("    â€¢ ë¹„ì–´ìˆëŠ” ê¸°ê°„ë§Œ íƒ€ê²ŸíŒ…")
        print("    â€¢ ë°°ì¹˜ ì²˜ë¦¬ë¡œ ì•ˆì •ì„± í™•ë³´")
        
        print("\n  Phase 3 (1ê°œì›” ë‚´): KIS API ì¶”ê°€")
        print("    ğŸ¯ ëª©í‘œ: ì‹¤ì‹œê°„ + ë¶„ë³„ ë°ì´í„°")
        print("    â€¢ ê³„ì¢Œ ê°œì„¤ + API ì‹ ì²­")
        print("    â€¢ ì‹¤ì‹œê°„ ì›¹ì†Œì¼“ ì—°ê²°")
        print("    â€¢ ë¶„ë³„ ë°ì´í„° ìˆ˜ì§‘ ì¶”ê°€")
        
        print("\n4ï¸âƒ£ ë°±í•„ ì „ëµ ìƒì„¸:")
        print("  ğŸ“… ì—°ë„ë³„ ë°±í•„ ì½”ë“œ ì˜ˆì‹œ:")
        print("    # 2020ë…„ ë°±í•„")
        print("    data_2020 = ticker.history(start='2020-01-01', end='2020-12-31')")
        print("    ")
        print("    # 2021ë…„ ë°±í•„")
        print("    data_2021 = ticker.history(start='2021-01-01', end='2021-12-31')")
        print("    ")
        print("    # ë¹„ì–´ìˆëŠ” êµ¬ê°„ë§Œ íƒ€ê²ŸíŒ…")
        print("    missing_ranges = find_missing_date_ranges(symbol)")
        print("    for start, end in missing_ranges:")
        print("        data = ticker.history(start=start, end=end)")
        
        print("\n5ï¸âƒ£ ì„±ëŠ¥ ì˜ˆìƒ:")
        print("  ğŸ“Š ë°±í•„ ì„±ëŠ¥ (ì¢…ëª©ë‹¹):")
        print("    â€¢ 1ë…„ ë°ì´í„°: ~250ì¼, 1íšŒ API í˜¸ì¶œ, ~3ì´ˆ")
        print("    â€¢ 5ë…„ ë°±í•„: 5íšŒ API í˜¸ì¶œ, ~15ì´ˆ")
        print("    â€¢ 1000ì¢…ëª© ë°±í•„: ~4ì‹œê°„ (ë°°ì¹˜ ì²˜ë¦¬)")
        
        print("\n  ğŸ“Š ì¼ì¼ ì¦ë¶„ ì—…ë°ì´íŠ¸:")
        print("    â€¢ í˜„ì¬: 18ì‹œê°„ â†’ ê°œì„  í›„: 5ë¶„")
        print("    â€¢ API í˜¸ì¶œ: 1200+ â†’ 1-3íšŒ")
        print("    â€¢ ì•ˆì •ì„±: ëŒ€í­ í–¥ìƒ")

def main():
    """ë©”ì¸ ë¶„ì„ ì‹¤í–‰"""
    
    print("ğŸ” KIS API í•´ì™¸ ì£¼ì‹ ë°ì´í„° ë¶„ì„")
    print("í˜„ì¬ ìƒí™©: ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ë³´ìœ ")
    print("ëª©í‘œ: 5ë…„ ì „ì²´ ë°ì´í„° í™•ë³´ + ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸")
    print("\n" + "=" * 60)
    
    analyzer = KISOverseaStockAnalysis()
    
    # API ê¸°ëŠ¥ ë¶„ì„
    analyzer.analyze_overseas_apis()
    
    # ì „ëµ ì¶”ì²œ
    analyzer.recommend_strategy()
    
    print("\n" + "=" * 60)
    print("ğŸ“ ê²°ë¡ :")
    print("1ï¸âƒ£ KIS API í•´ì™¸ ì£¼ì‹ ê³¼ê±° ë°ì´í„°: âŒ ì œí•œì  (ìµœëŒ€ 100ì¼)")
    print("2ï¸âƒ£ yfinance 5ë…„ ë°±í•„: âœ… ê°€ëŠ¥í•˜ê³  íš¨ìœ¨ì ")
    print("3ï¸âƒ£ í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ: âœ… ìµœì  (yfinance + KIS)")
    print("4ï¸âƒ£ ìš°ì„ ìˆœìœ„: yfinance ìµœì í™” â†’ ë°±í•„ â†’ KIS ì¶”ê°€")
    print("\nğŸ’¡ í˜„ì¬ Airflow ìˆ˜ì§‘ ì™„ë£Œ í›„ ë°±í•„ ì „ëµ êµ¬í˜„ ì¶”ì²œ!")

if __name__ == "__main__":
    main()
